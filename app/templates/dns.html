{% extends "_layout.html" %}
{% block content %}
<h1>dns</h1>

<form method="get" action="/dns">
  <label>domain
    <select name="domain_id">
      {% for d in domains %}
      <option value="{{d.id}}" {% if d.id==selected %}selected{% endif %}>{{d.name}}</option>
      {% endfor %}
    </select>
  </label>
  <button type="submit">switch</button>
</form>

{% if selected %}
<h2>add static (USER)</h2>
<form method="post" action="/dns/add">
  <input type="hidden" name="domain_id" value="{{selected}}">
  <label>name <input name="name" placeholder="@ / app / _srv._tcp.sub"></label>
  <label>type
    <select name="type">
      <option>A</option><option>AAAA</option><option>CNAME</option><option>TXT</option>
      <option>MX</option><option>NS</option><option>SRV</option>
    </select>
  </label>
  <label>content <input name="content" placeholder="IP/host; SRV JSON auto if left"></label>
  <label>ttl <input name="ttl" type="number" placeholder="auto"></label>
  <label>priority <input name="priority" type="number"></label>
  <label>proxied <input name="proxied" type="checkbox"></label>
  <button type="submit">add</button>
</form>

<form method="post" action="/dns/{{selected}}/sync">
  <button type="submit">sync (reconcile)</button>
</form>

<h2>records (SYSTEM + USER + IMPORTED)</h2>
<table>
  <tr><th>id</th><th>managed_by</th><th>name</th><th>type</th><th>content</th><th>ttl</th><th>priority</th><th>proxied</th><th>actions</th></tr>
  {% for r in records %}
  <tr>
    <td>{{ r.id }}</td>
    <td>{{ r.managed_by }}</td>
    <td>{{ r.name }}</td>
    <td>{{ r.type }}</td>
    <td>{{ r.content }}</td>
    <td>{{ r.ttl or "auto" }}</td>
    <td>{{ r.priority or "-" }}</td>
    <td>{{ "-" if r.proxied is none else ("yes" if r.proxied else "no") }}</td>
    <td>
      {% if r.managed_by == "USER" %}
      <form method="post" action="/dns/{{r.id}}/delete">
        <input type="hidden" name="domain_id" value="{{selected}}">
        <button>delete</button>
      </form>
      {% else %}-{% endif %}
    </td>
  </tr>
  {% endfor %}
</table>
{% endif %}
{% endblock %}
